openapi: 3.1.0
info:
  title: AI Knowledge Base Search API
  version: 2.0.0
  description: >
    Semantic search API for searching through a knowledge base of educational materials  in both Hungarian and English.
    Uses OpenAI's vector store for semantic similarity search.

    **Features:** - Bilingual search (Hungarian + English required) - Automatic pagination (max 100,000 characters per response) - Instant page navigation via Redis caching - Short proxy URLs for file downloads - Hybrid search (semantic + keyword) with configurable weights - Context expansion (±40k chars around any snippet)
servers:
  - url: https://api.z10n.dev
    description: Production API servera
paths:
  /api/context/{sha256}:
    get:
      operationId: getExpandedContext
      summary: Get extended context around a text snippet in a document
      description: >
        Retrieves ±40k chars around a snippet for deeper understanding. Use when search results need more context.
        GPT workflow: 1) Search finds relevant snippet 2) Call this to get full surrounding text 3) Answer with complete context.
      parameters:
        - name: sha256
          in: path
          required: true
          description: Document SHA256 hash from search results
          schema:
            type: string
            pattern: ^[a-f0-9]{64}$
            example: abc123def4567890...
        - name: snippet
          in: query
          required: true
          description: Text snippet from search result to find in document. Use 20-100 chars from search result content for best matching.
          schema:
            type: string
            minLength: 10
            maxLength: 2000
            example: leadership principles in scouting
        - name: context_chars
          in: query
          required: false
          description: Chars before and after match. Use 40k for comprehensive context, 10k for focused answers.
          schema:
            type: integer
            minimum: 1000
            maximum: 100000
            default: 40000
            example: 40000
      responses:
        "200":
          description: Extended context successfully retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ContextExpansionResponse"
              examples:
                context_example:
                  summary: Context expansion around leadership snippet
                  value:
                    sha256: 2bf42ff2ab25209fc6553d95bae7e3470a1e00024162df6b84a3766c028d5d6e
                    original_name: You are my leader_YOUAREMYLEADER-Tool.pdf
                    matched_text: How did you feel as a leader
                    context_before: "...observers to read their notes. The observations will be evaluated with the leaders and the players.\n\n3. Ask leaders questions: "
                    context_after: "?\", \"How was your delegation and management style?\", \"When you are in a stress, how do you behave to the others?\"..."
                    context_length: 12834
                    match_position: 3736
                    total_document_length: 12834
        "404":
          description: Document or snippet not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
                    example: Snippet not found in document
  /api/search:
    get:
      operationId: searchKnowledgeBase
      summary: Search the knowledge base with bilingual queries
      description: >
        Performs semantic search using Hungarian and English queries with automatic pagination (max 100k chars/page).
        Uses hybrid search (semantic + keyword) with configurable weights for optimal relevance.
      parameters:
        - name: qhu
          in: query
          required: true
          description: Hungarian search query (natural language)
          schema:
            type: string
            minLength: 2
            maxLength: 500
            example: cserkészet és vezetés
        - name: qen
          in: query
          required: true
          description: English search query (natural language)
          schema:
            type: string
            minLength: 2
            maxLength: 500
            example: scouting and leadership
        - name: page
          in: query
          required: false
          description: Page number (1-indexed, default 1)
          schema:
            type: integer
            minimum: 1
            default: 1
            example: 1
        - name: embedding_weight
          in: query
          required: false
          description: Weight for semantic similarity (0.0-1.0). Higher=conceptual. Default 0.7, use 0.9 for concepts, 0.5 for exact terms.
          schema:
            type: number
            minimum: 0.0
            maximum: 1.0
            default: 0.7
            example: 0.7
        - name: text_weight
          in: query
          required: false
          description: Weight for keyword matching (0.0-1.0). Higher=exact terms. Default 0.3, use 0.5-0.7 for names/technical terms.
          schema:
            type: number
            minimum: 0.0
            maximum: 1.0
            default: 0.3
            example: 0.3
      responses:
        "200":
          description: Successful search with results
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SearchResponse"
              examples:
                search_example:
                  summary: Bilingual search with pagination
                  value:
                    query: cserkészet | scouting
                    count: 12
                    total: 45
                    page: 1
                    page_size: 12
                    has_more: true
                    results:
                      - score: 0.8957
                        content:
                          - type: text
                            text: Scout advancement is something very special...
                        metadata:
                          original_name: Boy_Scouts_handbook.pdf
                          sha256: abc123...
                          original_file_url: https://api.z10n.dev/api/file/abc123...
                          processed_text_url: https://api.z10n.dev/api/text/abc123...
                semantic_focused:
                  summary: Semantic-focused search (conceptual query)
                  value:
                    query: vezetési elvek | leadership principles
                    count: 15
                    total: 52
                    page: 1
                    page_size: 15
                    has_more: true
                    results:
                      - score: 0.9124
                        content:
                          - type: text
                            text: Leadership is not about being in charge...
                keyword_focused:
                  summary: Keyword-focused search (specific terms)
                  value:
                    query: Holokauszt | Holocaust
                    count: 18
                    total: 41
                    page: 1
                    page_size: 18
                    has_more: true
                    results:
                      - score: 0.8448
                        content:
                          - type: text
                            text: The Holocaust education program focuses on...
        "400":
          description: Bad request - missing required parameters
          content:
            application/json:
              schema:
                type: object
                properties:
                  detail:
                    type: string
                    example: Both qhu and qen parameters are required
components:
  schemas:
    SearchResponse:
      type: object
      required:
        - query
        - results
        - count
      properties:
        query:
          type: string
          description: Combined query string (Hungarian | English)
          example: vezetés | leadership
        count:
          type: integer
          description: Number of results in current page
          minimum: 0
          example: 12
        total:
          type: integer
          description: Total number of results across all pages
          minimum: 0
          example: 45
        page:
          type: integer
          description: Current page number (1-indexed)
          minimum: 1
          example: 1
        page_size:
          type: integer
          description: Number of results in current page (varies by content size)
          minimum: 0
          example: 12
        has_more:
          type: boolean
          description: Whether more pages are available
          example: true
        results:
          type: array
          description: Search results sorted by relevance score
          items:
            $ref: "#/components/schemas/SearchResult"
    SearchResult:
      type: object
      required:
        - score
        - content
      properties:
        score:
          type: number
          description: Relevance score (0.0-1.0, higher is better)
          minimum: 0
          maximum: 1
          example: 0.8957
        content:
          type: array
          description: Text chunks from the document
          items:
            $ref: "#/components/schemas/ContentItem"
        metadata:
          $ref: "#/components/schemas/FileMetadata"
    ContentItem:
      type: object
      required:
        - type
        - text
      properties:
        type:
          type: string
          enum:
            - text
          example: text
        text:
          type: string
          description: Extracted text content from document
          example: Scout advancement is something very special...
    FileMetadata:
      type: object
      required:
        - original_name
        - sha256
      properties:
        original_name:
          type: string
          description: Original filename
          example: Boy_Scouts_handbook.pdf
        sha256:
          type: string
          description: SHA256 hash of the file
          pattern: ^[a-f0-9]{64}$
          example: abc123def4567890...
        original_file_url:
          type: string
          format: uri
          description: URL to download original file
          example: https://api.z10n.dev/api/file/abc123...
        processed_text_url:
          type: string
          format: uri
          description: URL to download processed text
          nullable: true
          example: https://api.z10n.dev/api/text/abc123...
    ContextExpansionResponse:
      type: object
      required:
        - sha256
        - original_name
        - matched_text
        - context_before
        - context_after
        - context_length
        - match_position
        - total_document_length
      properties:
        sha256:
          type: string
          description: Document SHA256 hash
          pattern: ^[a-f0-9]{64}$
        original_name:
          type: string
          description: Original filename
          example: Boy_Scouts_handbook.pdf
        matched_text:
          type: string
          description: The matched text snippet from the document
          example: Leadership principles in scouting emphasize...
        context_before:
          type: string
          description: Text content before the matched snippet (up to context_chars)
          example: The chapter on youth development discusses...
        context_after:
          type: string
          description: Text content after the matched snippet (up to context_chars)
          example: These principles form the foundation...
        context_length:
          type: integer
          description: Total length of returned context (before + match + after)
          example: 85432
        match_position:
          type: integer
          description: Character position of match in full document
          example: 12500
        total_document_length:
          type: integer
          description: Total character length of the full document
          example: 245000
